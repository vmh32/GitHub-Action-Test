name: 'NuGet Package Build and Release V2'
description: 'Build and release NuGet packages with dependency management (Version 2)'

inputs:
  projects:
    description: 'Project configurations in JSON format'
    required: true
  github_token:
    description: 'GitHub token for API access'
    required: true

outputs:
  changed_projects:
    description: 'List of projects that were changed'
    value: ${{ steps.detect_changes.outputs.modified_packages }}
  ordered_changes:
    description: 'List of projects in dependency order'
    value: ${{ steps.detect_changes.outputs.ordered_changes }}
  has_nuspec:
    description: 'Whether any changed package uses nuspec'
    value: ${{ steps.detect_changes.outputs.has_nuspec }}

runs:
  using: "composite"
  steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    - name: Install dependencies
      shell: bash
      run: |
        python -m pip install --upgrade pip
        pip install requests

    - name: Run change detection
      id: detect_changes
      shell: bash
      env:
        GITHUB_TOKEN: ${{ inputs.github_token }}
        INPUT_PROJECTS: ${{ inputs.projects }}
      run: python ${{ github.action_path }}/src/detect_changes.py 